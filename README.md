# Taski
Приложение для планирования своих задач.

# Как развернуть проект на сервере:
Для подключения к Вашему серверу по протоколу SSH Вам понадобятся следующие данные:
* login для подключения к серверу;
* ip - IP-адреc сервера, а также желательно доменное имя;
* passphrase - пароль от закрытого SSH-ключа;
* файл с расширением .pub — открытый SSH-ключ;
* файл без расширения — закрытый SSH-ключ.

Если вы работаете под ОС Linux или macOS, то у вас наверняка есть SSH-клиент, он по умолчанию встроен в терминал.
Пользователям Windows мы рекомендуем установить Git Bash версии 2.36.0 или выше. SSH-клиент встроен в этот терминал.
Чтобы убедиться, что SSH-клиент у Вас есть, откройте терминал и введите команду:
```
ssh -V
```
Для подключения  к серверу используйте команду:
```
ssh -i путь_до_файла_с_SSH_ключом/название_файла_закрытого_SSH-ключа login@ip
```
## Подключить удаленный сервер к аккаунту на GitHub
Установить на сервере git, используя команду:
```
sudo apt install <имя_пакета>
```
или проверьте, что git уже установлен:
```
sudo apt update
git --version
```

Находясь на сервере, сгенерируйте пару SSH-ключей, выведите публичный ключ в консоль, скопируйте его и запишите в настройки вашего аккаунта на GitHub.
(можно по [инструкции](https://file.notion.so/f/f/1c00a917-6a50-4d8a-a607-d24904249cd0/cce9043b-0706-44bc-9730-53923cef05ab/Настройка_SSH_для_GitHub.pdf?table=block&id=2ccd2557-d585-4e6d-980b-b0a3319229cd&spaceId=1c00a917-6a50-4d8a-a607-d24904249cd0&expirationTimestamp=1724284800000&signature=FpJxT18lS-aTUEcG6PS41N-sm05oMkufeXhAAnlMZjc&downloadName=Настройка+SSH+для+GitHub.pdf))

### Клонируйте код приложения с GitHub на сервер:
Находясь на сервере, выполните команду:
```
git clone git@github.com:Ваш_аккаунт/taski.git
```

1. Установливаем на сервер необходимые компоненты: интерпретатор Python, менеджер пакетов pip, утилиту для создания виртуального окружения venv. Если Ваш сервер работает под управлением операционной системы Ubuntu, в неё предустановлен интерпретатор Python третьей версии. Убедитесь в этом — находясь на сервере, выполните команду:

```
python3 -V
```
Далее установите на сервер пакетный менеджер и утилиту для создания виртуального окружения. Сделать это можно одной командой, перечислив все необходимые к установке пакеты:

```
sudo apt install python3-pip python3-venv -y 
```

2. Установить зависимости из файла requirements.txt:
```
# Переходим в директорию backend-приложения проекта.
cd taski/backend/
# Создаём виртуальное окружение.
python3 -m venv venv
# Активируем виртуальное окружение.
source venv/bin/activate
# Обновляем pip в виртуальном окружении
pip install --upgrade pip
# Устанавливаем зависимости.
pip install -r requirements.txt
```
3. Выполнить миграции и создайте суперпользователя:
```
# Применяем миграции.
python manage.py migrate
# Создаём суперпользователя.
python manage.py createsuperuser
```
## Запускаем бекэнд
Чтобы проект запустился через внешний интерфейс, нужно явно добавить IP-адрес вашего сервера в «список разрешённых хостов» ALLOWED_HOSTS в файл settings.py:
```
# Открываем файл settings.py
nano settings.py
```
В список ALLOWED_HOSTS добавьте:
внешний IP-адрес вашего сервера для доступа к приложению по внешнему интерфейсу,
адреса 127.0.0.1 и localhost для доступа к приложению по внутреннему интерфейсу:
```
# Вместо xxx.xxx.xxx.xxx укажите IP вашего сервера.
ALLOWED_HOSTS = ['xxx.xxx.xxx.xxx', '127.0.0.1', 'localhost'] 
```
Теперь можно перейти в админку по ссылке http://ваш_публичный_IP:8000/admin/ и авторизоваться от имени созданного вами суперпользователя или можно перейти по ссылке http://ваш_публичный_IP:8000/api/, чтобы открыть встроенный интерфейс отладки Browsable API.
Останавливаем бекэнд сервер.

## Запускаем фронтенд
Фронтенд-приложение проекта Taski написано на React. Чтобы его запустить, нужно:
* Установить на сервер пакетный менеджер npm. Самый простой способ начать работу с npm — это установить на сервер Node.js, с которой менеджер пакетов идёт в комплекте. Находясь на сервере, из любой директории выполните команду (скопируйте её целиком и вставьте в терминал):
```
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - &&\
sudo apt install -y nodejs
```
После установки Node.js сервер, скорее всего, снова попросит перезагрузить операционную систему. Перезагружайте её и двигайтесь дальше.
Далее убедитесь, что пакетный менеджер npm тоже установился. Выполните команду:
```
npm -v
```
В ответ должна вывестись версия пакетного менеджера.
* Установить зависимости для фронтенд-приложения. Перейдите в директорию taski/frontend/ и выполните команду:
```
npm i
```
Запустите приложение командой:
```
npm run start
```
проверяем по по ссылке http://ваш_публичный_IP:3000 и останавливаем фронтенд сервер.
## Устанавливаем и запускаем Gunicorn
На удалённом сервере при активированном виртуальном окружении проекта Taski установите пакет gunicorn:
```
pip install gunicorn==20.1.0
```
Перейдите в директорию с файлом manage.py (taski/backend) и запустите Gunicorn:
```
gunicorn --bind 0.0.0.0:8000 backend.wsgi
```
Создаём юнит для Gunicorn. В директории /etc/systemd/system/ создайте файл gunicorn.service и откройте его в Nano. Для создания файла в системной папке нужны права администратора, их даёт команда sudo. Выполните команду:
```
sudo nano /etc/systemd/system/gunicorn.service 
```
В файле gunicorn.service опишите конфигурацию процесса. 
Подставьте в код из листинга свои данные, добавьте этот код без комментариев в файл gunicorn.service и сохраните изменения:
```
[Unit]
# Это текстовое описание юнита, пояснение для разработчика.
Description=gunicorn daemon 

# Условие: при старте операционной системы запускать процесс только после того, 
# как операционная система загрузится и настроит подключение к сети.
# Ссылка на документацию с возможными вариантами значений 
# https://systemd.io/NETWORK_ONLINE/
After=network.target 

[Service]
# От чьего имени будет происходить запуск:
# укажите имя пользователя, под которым вы подключались к серверу по ssh.
User=yc-user 

# Путь к директории проекта:
# /home/<имя-пользователя-в-системе>/
# <директория-с-проектом>/<директория-с-файлом-manage.py>/.
# Например:
WorkingDirectory=/home/yc-user/taski/backend/

# Команду, которую вы запускали руками, теперь будет запускать systemd:
# /home/<имя-пользователя-в-системе>/
# <директория-с-проектом>/<путь-до-gunicorn-в-виртуальном-окружении> --bind 0.0.0.0:8000 backend.wsgi
ExecStart=/home/yc-user/taski/backend/venv/bin/gunicorn --bind 0.0.0.0:8000 backend.wsgi

[Install]
# В этом параметре указывается вариант запуска процесса.
# Значение <multi-user.target> указывают, чтобы systemd запустил процесс,
# доступный всем пользователям и без графического интерфейса.
WantedBy=multi-user.target
```
Для просмотра процессов вопользуемся командой:
```
sudo systemctl
```
Чтобы запустить, остановить или перезапустить процесс, используется команда sudo systemctl с параметрами start, stop или restart.
Запустите процесс gunicorn.service:
```
sudo systemctl start gunicorn
```
Дополнительной командой добавьте процесс Gunicorn в список автозапуска операционной системы на удалённом сервере:
```
sudo systemctl enable gunicorn
```
После небольшого ожидания можно будет проверить работоспособность запущенного демона. Для этого воспользуйтесь командой:
```
sudo systemctl status gunicorn
```
 Вы установили и настроили WSGI-сервер Gunicorn: он будет запускаться при старте операционной системы на удалённом сервере, а если возникнут проблемы — автоматически перезагрузится. Вручную им тоже можно управлять, для этого есть команды sudo systemctl start/stop/restart gunicorn.

 